[General]
# --- GENERAL ---
# Enhanced Wi-Fi Assist
wifi-assist = false
# Hybrid Network
all-hybrid = true
# Latency Benchmark
internet-test-url = http://bing.com
proxy-test-url = http://cp.cloudflare.com/generate_204
test-timeout = 5
# GeoIP Database
geoip-maxmind-url = https://raw.githubusercontent.com/Loyalsoldier/geoip/release/Country.mmdb
# IPv6 Support
ipv6 = true
# --- Wi-Fi ACCESS ---
# 若允许远程访问将 <false> 改为 <true>,仅 iOS
allow-wifi-access = true
allow-hotspot-access = true
wifi-access-http-port = 6152
wifi-access-socks5-port = 6153
# 若允许远程访问将 <127.0.0.1> 改为 <0.0.0.0>,仅 macOS
http-listen = 127.0.0.1:6152
socks5-listen = 127.0.0.1:6153
# --- REMOTE CONTROLLER ---
# Remote Controller
external-controller-access = key@127.0.0.1:8888
# HTTP API & Web Dashboard
# This option allows using HTTP APIs to control
http-api = key@0.0.0.0:6166
# 使用 HTTPS 替代 HTTP 协议，需要先配置 MitM 的 CA 证书，同时需要在客户端设备上手动安装并信任 CA 证书。
http-api-tls = false
# 开启该选项后可以通过浏览器控制 Surge，本机浏览器输入127.0.0.1:6166
http-api-web-dashboard = true
# --- COMPATIBILITY ---
# 兼容模式
compatibility-mode = False
# 跳过代理
skip-proxy = 127.0.0.1, 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12, 100.64.0.0/10, passenger.t3go.cn, localhost, *.local
# 排除简单主机名
exclude-simple-hostnames = true
# --- DNS ---
# The IP addresses of upstream DNS servers
dns-server = 223.5.5.5, 119.29.29.29, 8.8.8.8, system
# 从 /etc/hosts 读取 DNS 记录
read-etc-hosts = true
# The URL of the DNS-over-HTTPS server
# doh-server = https://doh.pub/dns-query //DNSPod
# DoH 请求通过代理策略执行
doh-follow-outbound-mode = false
# --- ROUTING ---
# 包含所有网络请求
include-all-networks = false
# 包含本地网络请求
include-local-networks = false
# --- ADVANCED ---
# Log Level
loglevel = notify
# 当遇到 REJECT 策略时返回错误页
show-error-page-for-reject = true
# Always Real IP Hosts
always-real-ip = link-ip.nextdns.io, *.msftconnecttest.com, *.msftncsi.com, *.srv.nintendo.net, *.stun.playstation.net, xbox.*.microsoft.com, *.xboxlive.com, *.logon.battlenet.com.cn, *.logon.battle.net, stun.l.google.com
# Hijack DNS
hijack-dns = 8.8.8.8:53, 8.8.4.4:53
# TCP Force HTTP Hosts
force-http-engine-hosts = *.ott.cibntv.net, 123.59.31.1,119.18.193.135, 122.14.246.33, 175.102.178.52, 116.253.24.*, 175.6.26.*, 220.169.153.*
# VIF Excluded Routes
# tun-excluded-routes = 239.255.255.250/32
# VIF Included Routes
# tun-included-routes = 192.168.1.12/32
# 当 Wi-Fi 不是首选网络时 SSID 组策略使用默认策略
use-default-policy-if-wifi-not-primary = false
# 控制当 UDP 流量被匹配到一个不支持 UDP 转发的策略时的行为
# - DIRECT：回退到 DIRECT 策略（默认）
# - REJECT：回退到 REJECT 策略
udp-policy-not-supported-behaviour = REJECT

[Replica]
# 抓取流量 => 过滤器 1为开启，0为关闭
# 隐藏 Apple 请求
hide-apple-request = 1
# 隐藏 Crashlytics 请求
hide-crash-reporter-request = 1
# 隐藏 UDP 会话
hide-udp = 1
# 关键词过滤器
# none（关闭关键词过滤器） / whitelist（仅记录包含关键词的请求） / blacklist（仅记录不包含关键词的请求） / pattern（记录匹配通配符的请求）
keyword-filter-type = blacklist
keyword-filter = icloud, ocsp, logs, analytic, imap, adthor, applovin, appnext, talk, dropbox, github, spys, nexdns, 149.154, 91.108

[Proxy]
# 当请求为 HTTP 请求时返回一个极小的 GIF
REJECT-TINYGIF = reject-tinygif
# 阻止请求
REJECT = reject
# 直接连接
DIRECT = direct



[Proxy Group]
Final = select, Proxy🪁, DIRECT
# Subnet⛺️ = subnet, default = Proxy🪁, "SSID:value" = DIRECT, "TYPE:CELLULAR" = Proxy🪁, hidden = true
Proxy🪁 = select, 🇺🇸 America, 🇭🇰 Load balance, 🇸🇬 Singapore, 🇨🇳 Fallback, policy-path=https://sub.store/download/STT // policy-path=https://887655.xyz/api/v1/client/subscribe?token=4fbcffd09914d6b25d0b7de875bc39ed
GlobalMedia = select, 🇺🇸 America, 🇭🇰 Load balance, 🇸🇬 Singapore, 🇨🇳 Fallback
Netflix = select, 🇺🇸 America, 🇭🇰 Load balance, 🇸🇬 Singapore, 🇨🇳 Fallback
Twitter = select, 🇺🇸 America, Proxy🪁
Telegram = select, 🇭🇰 Load balance, 🇸🇬 Singapore, hybrid=off // hybrid=off 即使在 All Hybrid 或 WiFi Assist 开启时，有 WiFi 就不使用数据网络
Apple = select, DIRECT, Proxy🪁
AdBlock = select, REJECT, DIRECT, REJECT-TINYGIF
🇺🇸 America = url-test, include-other-group=Proxy🪁, policy-regex-filter=美国, interval=600, tolerance=100, evaluate-before-use=true, hidden=true
🇭🇰 Load balance = load-balance, include-other-group=Proxy🪁, policy-regex-filter=(香港|HK), interval=-1, tolerance=100, persistent=true, hidden=true
🇸🇬 Singapore = load-balance, include-other-group=Proxy🪁, policy-regex-filter=(新加坡|狮城), interval=-1, tolerance=100, persistent=true, hidden=true
🇨🇳 Fallback = fallback, include-other-group=Proxy🪁, policy-regex-filter=台湾, timeout=3, interval=600, evaluate-before-use=true, hidden=true

[Rule]
# --- CUSTOM RULES ---
# 新增内置策略 NO-HYBRID，等价为 NO-HYBRID = direct, hybrid=off
DOMAIN-SUFFIX,cmbchina.com,NO-HYBRID // 部分服务会校验请求的来源 IP，在开启 hybrid 时有可能因为请求IP变化导致无法正常登录和使用（如招商银行），可使用 NO-HYBRID 对特定请求单独关闭 All Hybrid
# HTTP3/QUIC 协议基于 UDP，部分地区 ISP 或线路 UDP 容易受到干扰或限速，屏蔽掉以阻止 HTTP 3 流量的 UDP 流量，强制回退到 TCP。
# REJECT-NO-DROP 表示不使用默认的自动丢包逻辑，这样 Surge 每次都会返回 ICMP Port Unreachable，应用会立刻回退而不是等超时。
AND,((PROTOCOL,UDP), (DEST-PORT,443)),REJECT-NO-DROP
# Download
PROCESS-NAME,aria2c,DIRECT
PROCESS-NAME,fdm,DIRECT
PROCESS-NAME,Folx,DIRECT
PROCESS-NAME,NetTransport,DIRECT
PROCESS-NAME,Thunder,DIRECT
PROCESS-NAME,Transmission,DIRECT
PROCESS-NAME,uTorrent,DIRECT
PROCESS-NAME,WebTorrent,DIRECT
PROCESS-NAME,WebTorrent Helper,DIRECT
# External Resources Update
AND,((DOMAIN,raw.githubusercontent.com), (DOMAIN-SUFFIX,github.io), (USER-AGENT,Surge/*)),Final,notification-text="♻️External Resources Update",notification-interval=3600
# Blocking UDP Packets by Youtube and ins
AND,((DOMAIN-SUFFIX,googlevideo.com), (DOMAIN-SUFFIX,gvt1.com), (DOMAIN-SUFFIX,cdninstagram.com), (PROTOCOL,UDP)),REJECT
# --- RULE-SET ---
# Unbreak
RULE-SET,https://blankmagic.github.io/surge/rule/Unbreak.list,DIRECT
# Advertising
RULE-SET,https://blankmagic.github.io/surge/rule/block/Adblock.list,AdBlock
# Privacy
RULE-SET,https://blankmagic.github.io/surge/rule/block/Privacy.list,AdBlock
# Hijacking
RULE-SET,https://blankmagic.github.io/surge/rule/block/Hijacking.list,AdBlock
# Netflix
RULE-SET,https://blankmagic.github.io/surge/rule/media/Netflix.list,Netflix
# GlobalMedia
RULE-SET,https://blankmagic.github.io/surge/rule/GlobalMedia.list,GlobalMedia
# Twitter
RULE-SET,https://blankmagic.github.io/surge/rule/Twitter.list,Twitter
# Telegram
RULE-SET,https://blankmagic.github.io/surge/rule/Telegram.list,Telegram
# Global
RULE-SET,https://blankmagic.github.io/surge/rule/Global.list,Proxy🪁
# Apple
RULE-SET,https://blankmagic.github.io/surge/rule/apple/Apple.list,Apple
# Domestic
RULE-SET,https://blankmagic.github.io/surge/rule/Domestic.list,DIRECT
IP-CIDR,0.0.0.0/32,REJECT,no-resolve
# Local Area Network & GeoIP China
OR,((RULE-SET,SYSTEM), (RULE-SET,LAN), (GEOIP,CN)),DIRECT
FINAL,Final,dns-failed

[Host]
# Firebase Cloud Messaging
mtalk.google.com = 108.177.125.188
# Google Dl
dl.google.com = server:119.29.29.29
dl.l.google.com = server:119.29.29.29
update.googleapis.com = server:119.29.29.29
# PlayStation
*.dl.playstation.net = server:119.29.29.29
# Router Admin Panel
amplifi.lan = server:syslib // Ubiquiti Amplifi Router
router.synology.com = server:syslib // Synology Router
sila.razer.com = server:syslib // Razer Sila Router
router.asus.com = server:syslib // Asus Router
routerlogin.net = server:syslib // Netgear Router
orbilogin.com = server:syslib // Netgear Obri Router
www.LinksysSmartWiFi.com = server:syslib // Linksys Router
LinksysSmartWiFi.com = server:syslib // Linksys Router
myrouter.local = server:syslib // Linksys Router
www.miwifi.com = server:syslib // Xiaomi Mi WiFi Router
miwifi.com = server:syslib // Xiaomi Mi WiFi Router
mediarouter.home = server:syslib // Huawei Router
tplogin.cn = server:syslib // TP-Link Router
tplinklogin.net = server:syslib // TP-Link Router
melogin.cn = server:syslib // MERCURY Router
falogin.cn = server:syslib // FAST Router


[URL Rewrite]
# Redirect Google Search Service
^https?:\/\/(www.)?(g|google)\.cn https://www.google.com 302
# Redirect Google Maps Service
^https?:\/\/(ditu|maps).google\.cn https://maps.google.com 302
# Redirect HTTP to HTTPS
^https?:\/\/(www.)?taobao\.com\/ https://taobao.com/ 302
^https?:\/\/(www.)?jd\.com\/ https://www.jd.com/ 302
^https?:\/\/(www.)?mi\.com\/ https://www.mi.com/ 302
^https?:\/\/you\.163\.com\/ https://you.163.com/ 302
^https?:\/\/(www.)?suning\.com\/ https://suning.com/ 302
^https?:\/\/(www.)?yhd\.com\/ https://yhd.com/ 302
# AbeamTV
^https?:\/\/api\.abema\.io\/v\d\/ip\/check - reject
# CUSTOM URL header


[SSID Setting]
# Temporarily Suspend
"SSID Here" suspend=true
# TCP Fast Open
"My Home" tfo-behaviour=force-enabled
TYPE:CELLULAR tfo-behaviour=force-disabled

[Script]
酷我音乐 = type=http-response,pattern=^http://(.+).kuwo.cn(/v2/api/user/info|/a.p|/vip/v2/user/vip),requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/PF2022/surge-js/main/kw.js,script-update-interval=0
陆琪讲故事 = type=http-response,pattern=^https:\/\/www\.luqijianggushi\.com\/api\/v2\/user\/get,requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/NobyDa/Script/master/Surge/JS/luqi.js,script-update-interval=0
PicsArt = type=http-response,pattern=https:\/\/api\.(picsart|meiease)\.c(n|om)\/users\/show\/me\.json,requires-body=0,script-path=https://raw.githubusercontent.com/NobyDa/Script/master/Surge/JS/PicsArt.js,script-update-interval=0
# Flush DNS, show the DNS delay and server.
flushDNS = type=generic,timeout=10,script-path=https://raw.githubusercontent.com/zZPiglet/Task/master/asset/flushDNS.js,argument=icon=wand.and.stars.inverse&color=#3d3d5b,script-update-interval=0

[MITM]
skip-server-cert-verify = true
hostname = *.kuwo.cn, www.luqijianggushi.com, api.picsart.c*, api.meiease.c*, www.google.cn, api.abema.io, *.zhihu.com, vip1.kuwo.cn-CUSTOMMitM
ca-passphrase = BBC3FF84
ca-p12 = MIIKPAIBAzCCCgYGCSqGSIb3DQEHAaCCCfcEggnzMIIJ7zCCBF8GCSqGSIb3DQEHBqCCBFAwggRMAgEAMIIERQYJKoZIhvcNAQcBMBwGCiqGSIb3DQEMAQYwDgQIftht4gjXK4gCAggAgIIEGLFR5aPX+4EFnL2nIclWeIGPdbo7AqZE+QIFN/MKHy2N9IxaAazJKfiJTZy9wQZG+PB1fEdQWRTaAVOk/3WQFkCxZmhzk1rjn7MaQL40Y2Wgjc4yGtJ0dbBvtkRoQF5VRDsFQ92aH1zwxCRC1PQNBBCj51MlOevolm53pSYhdp96P8XyYeo3w8TifPNyDHecZ8QthFfFYK+ijdevyMnw5InTbBRTNV8wfMo8uFceJvi7J800pOZLWgEsSoSGfiuEZ6HISKX2tdEMRPVUAUB5VdhrzjSgnnJqCmXgQcqg2IZh2pJ6PfGr03lvQDXDi9MiOTO4FitOK18C0i4yZjfDmL9FBSh8bjDqlXHkRv//+qVe/BQKXu2TN2RO1/2S1NxTUNOwYKJP2uOPkxvN9xTSuRTw1C4ywf8y4h9suEq7uPHkvxIi9OmDe2KhOzcwXD4luVH7AuGJUsgxWzyU2ZLLPjE6irS9FlEB2XmZFksTsR/wLLhu/nL7BKIUZ3/JcfTzrFY1c2idMJhKjKM9anfzG9uzBtMmLl9cLuhKUdfJBCwdpWBgmGthqDP0KkHau/S3InZjxo9+QX34adS4D//bBn8402SivnsrSSpfeCHoodYdvaHmOCTbh+rthpLfDeDviUoVTNErbzHx0l95cYFuQSW0gOhyjxE6oMYpT7EDi2/pDOX9gKeGhmbH063aAY9pUz7lvKvSY6aulVmH+G7YFgel/pHOCFmfzu1OIuC6IgbKQOwu6RVi0vBFW48nxXsV7y4/UJDjt7zjw6d6v4Ez6GX+6ys2u7aiztQ7qdPXTZ2RIlDSMYwKeVQoX0lIBcxHSBxFkWHDkLu+u2t9UJzGjkNPjTfgMLYePsR5rugBEFGXu2lv7YyVv0LTnUtU/u9QmvQNbt7oPdWJ5oE6vXpp/ahhtcdOyUSjuMZazQg7R05tr0X9q3+hJfM0y7+40rtqLZVD6lxPBWR82w4Yb3CZIg3wsS5BoJrthkjDInoZl1JKf4NdBP4YQabLjoPzIHx4J7wg2LQddrdIYYh+t2l88EeKUSnhtWXMXq0cc+JEb66ZmDW6+2VxOpoDnO0To6v8LDWhTEz449p0vPLNrwWOg1SX0/1w76jCsIA0Ee9nNDzeFS4n2pblpEXhHjBBBcnhDO/y+sDo7nXgYe5B+ZGBRs5+9UClurHam9qtCUnbTvsNj0jSaiqzX7yo9VNgDli313aV2LxeIkQBGpqgHlKVDiuYuIpJ5kK4HF1Cs+geaxHM2EtFKPXzgeBI94tRZuRUjjYcu8l6lLa8ekKP6yl5fYPpwPOmAUg+RMqZwd7FmXY8dqn1/w06dhnWfYgh1YKJfFNmix8giiBjrWvAanFxNUFJ+dNbXMUXxbmJqntMnIEUp1zQ8tLKqJ8wggWIBgkqhkiG9w0BBwGgggV5BIIFdTCCBXEwggVtBgsqhkiG9w0BDAoBAqCCBO4wggTqMBwGCiqGSIb3DQEMAQMwDgQIv4QVyK2L1SMCAggABIIEyHRqn8LS4hno+5LnacKSDXjCmm20JXOT2DCQs+Xf6zKFM+AaxqAGKQ5BPZJkNgcajk/jfdD1CCpZ5ZSnWl1sr+zY0dhswH0arTUtvOmEQ3+NERWKLqtBMLBPO6gjsy3BKUY6WXvWU5iKyH4DyDv8sb+OmVjhjWq8BJZqRAyVSGqWrMXJCqHiQ8LwJPd54qIRByPHe0/A/H5coh0zdfJMJwKSTPuXU9MTptV+uIw7AsK/i4rxakP0HOGLADLNphSln287U9wB5ViflZ/JLbyhh4ayAapRNmtaUTyj1hAwMvfBZ5a3yyX8j+orcJwbqFEKhkUVBEuppxZ2jQTy4K+n8mCCVs+baRg2RtPpwl+rbGdkcBJavWPjh4MyUkN+3t+iAJ1OXOXTFuHzHVhHUhYjw787zRSi4xkq+3MoXFyVqrHxBxHAyl3Rk5VbG5DDlmVnG8hyTLuIKvJ3CM4TH287ACUGf9MVjI2GxJFxOWrWXw6tJOWRyDwiagxtSQi20sFKQIva5n2YHkypPfyKno6IJD1/5AGWt0yJ/J7BFysejLSZzQP82Sogrc8Q/YyyIy23YGN787yY3x2x3WQapjKgLWgfbcEHxbuZkoXcLFBCifu9vJuDU47hV+awFOK+avOW06DcV1+NYoPD0PMjGZdKcrsZrNUia/Q9F+IuWscztli/LCCtBdrnqU6tO6k7HaJ2a1GsSihZHGrU7Ud+zgyOsanQdogGQxskD8ND2yp9ger59jXED55wkYsjjAcEBCvbXJ6lLU56FlfjVAzANGEVeH2lGnEkQfqcYOaf2Vr5zV36ctj2WHgktTv0PYnPambkrG0U4B7pugA20cxE8VSCbX5Dr5QWLAk2KOfuxjfDBPVlcFMk0l1qXeeNC8/x7afIWdPPEXuJZN9t3B0TQxFBNNH0AINeLe2+1l94nqB+8CXa1j5Ni9pGE738PNE6fjcGXQ7+VH0w75qUaaqt5ZKGVARconXikmtfUpXKsQHWX3zhLbh4yvnGWjvZuqJhw2ePBrzOcQZ/32HA/JSj7eOBjRQt1OsgrvcmlKfGzwuqHP3ZTni3FnUCOr2CTrj2ero8fxzp1kc7tJk3PyenGGTcwtjNnyoV5t2VdZDd/MOsUq+v+w3mA8LQplrdeM1Fxrqf78a8jrdMwgNjeqK28WbdZD2NIoHZH5R3muyIGmVrwm8W/pdgJavk11l04vH5f5h0/kdrgD+MmE8+ZWCQL3MQPX0GAHod7gKgFuf4oJ0s4ARjlkkC/Iev+seEXT9CMx4UkIhpXIsRUKFqEsnlQ78R7eXVUNU1S3h8K4uAmx5FCTqO+BdSVUDGTx01iwFBNhzVb17cWGa1tPYpBykBGm8gQoBYjl1YQIaiHBplsf9UrqicUWuKC26scK1ObOm6+86vg2nBn0+EmiuSuevw023mHewOjidsJZXW6iP6uBUyvoaGrYDhrd7ypTZM4NPLMo2W8IEBg1hP6qltbx4DeMhPepJC24nSb1sBmbVKpgYJYl8vkDAGe1smSCnZ+wn4GXoGZZ3d11YuBaUuhfQS0yjtWS6w8qnUS2d/zGa8Uh2vAZEvHpg6G+sR8+2J70fznNaR3A1y/W0pHfvzEOVGSiR0/sGVqk9tNvxlMTFsMCMGCSqGSIb3DQEJFTEWBBR14q3M6VoXYszIbNoSCbCm7f/HBjBFBgkqhkiG9w0BCRQxOB42AFMAdQByAGcAZQAgAEcAZQBuAGUAcgBhAHQAZQBkACAAQwBBACAAQgBCAEMAMwBGAEYAOAA0MC0wITAJBgUrDgMCGgUABBR8F01BUBP+T9CVeumQA5h5lsdO1QQIf7M6rzes/VU=



[Panel]
flushDNS = script-name=flushDNS,update-interval=-1
