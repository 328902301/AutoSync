### subscription-url=
port: 7890
socks-port: 7891
allow-lan: true
mode: rule
log-level: error
external-controller: 127.0.0.1:9090
dns:
  enable: true
  listen: 0.0.0.0:53
  default-nameserver:
    - 114.114.114.114
    - 8.8.8.8
  enhanced-mode: redir-host
  nameserver:
    - 114.114.114.114
    - 8.8.8.8
    - tls://dns.rubyfish.cn:853
    - https://1.1.1.1/dns-query

rules:
  - RULE-SET,Unbreak, DIRECT
  - RULE-SET,Advertising, 全局拦截
  - RULE-SET,Hijacking, REJECT
  - RULE-SET,Privacy, REJECT
  - RULE-SET,Global, 节点选择
  - RULE-SET,Streaming, 国外媒体
  - RULE-SET,StreamingSE, 港台番剧
  - RULE-SET,Apple, 苹果服务
  - RULE-SET,AppleMusic, 苹果服务
  - RULE-SET,China, DIRECT
  - GEOIP,CN, DIRECT
  - MATCH, 漏网之鱼

proxy-providers:

  MiaoZ:
    type: http
    url: ""
    interval: 86400
    path: ./providers/MiaoZ.yaml
    health-check:
      enable: true
      interval: 600
      lazy: true
      url: http://www.gstatic.com/generate_204

rule-providers:
  Unbreak:
    type: http
    behavior: classical
    url: https://cdn.jsdelivr.net/gh/DivineEngine/Profiles@master/Clash/RuleSet/Unbreak.yaml
    path: ./RuleSet/Unbreak.yaml
    interval: 86400
  Advertising:
    type: http
    behavior: classical
    url: https://cdn.jsdelivr.net/gh/DivineEngine/Profiles@master/Clash/RuleSet/Guard/Advertising.yaml
    path: ./RuleSet/Guard/Advertising.yaml
    interval: 86400
  Privacy:
    type: http
    behavior: classical
    url: https://cdn.jsdelivr.net/gh/DivineEngine/Profiles@master/Clash/RuleSet/Guard/Privacy.yaml
    path: ./RuleSet/Guard/Privacy.yaml
    interval: 86400
  Hijacking:
    type: http
    behavior: classical
    url: https://cdn.jsdelivr.net/gh/DivineEngine/Profiles@master/Clash/RuleSet/Guard/Hijacking.yaml
    path: ./RuleSet/Guard/Hijacking.yaml
    interval: 86400
  Streaming:
    type: http
    behavior: classical
    url: https://cdn.jsdelivr.net/gh/DivineEngine/Profiles@master/Clash/RuleSet/StreamingMedia/Streaming.yaml
    path: ./RuleSet/StreamingMedia/Streaming.yaml
    interval: 86400
  StreamingSE:
    type: http
    behavior: classical
    url: https://cdn.jsdelivr.net/gh/DivineEngine/Profiles@master/Clash/RuleSet/StreamingMedia/StreamingSE.yaml
    path: ./RuleSet/StreamingMedia/StreamingSE.yaml
    interval: 86400
  Global:
    type: http
    behavior: classical
    url: https://cdn.jsdelivr.net/gh/DivineEngine/Profiles@master/Clash/RuleSet/Global.yaml
    path: ./RuleSet/Global.yaml
    interval: 86400
  Apple:
    type: http
    behavior: classical
    url: https://cdn.jsdelivr.net/gh/DivineEngine/Profiles@master//Clash/RuleSet/Extra/Apple/Apple.yaml
    path: ./RuleSet/Extra/Apple.yaml
    interval: 86400
  AppleMusic:
    type: http
    behavior: classical
    url: https://cdn.jsdelivr.net/gh/DivineEngine/Profiles@master//Clash/RuleSet/Extra/Apple/Music.yaml
    path: ./RuleSet/Extra/Music.yaml
    interval: 86400
  China:
    type: http
    behavior: classical
    url: https://cdn.jsdelivr.net/gh/DivineEngine/Profiles@master/Clash/RuleSet/China.yaml
    path: ./RuleSet/China.yaml
    interval: 86400

proxy-groups:
  - name:  节点选择
    type: select
    proxies:
      - 自动筛选
      - DIRECT
    use:
      - MiaoZ

  - name:  自动筛选
    type: url-test
    use:
      - MiaoZ
    url: 'http://www.gstatic.com/generate_204'
    interval: 300

  - name:  国外媒体
    type: select
    proxies:
      - 节点选择
      - DIRECT

  - name:  港台番剧
    type: select
    proxies:
      - 节点选择
      - DIRECT

  - name:  全局拦截
    type: select
    proxies:
      - REJECT
      - DIRECT

  - name:  苹果服务
    type: select
    proxies:
      - 节点选择
      - DIRECT

  - name:  漏网之鱼
    type: select
    proxies:
      - 节点选择
      - DIRECT
mitm:
  enable: true
  hostnames:
  - '*.jd.com'
  - 'www.google.cn'
  - '*.google.com'
  - api.douban.com
  - erebor.douban.com
  ca:
    passphase: 
    certificate: 
rewrite:
- regex: ^https?://www.google.cn/(.*)
  match: url
  action: "302"
  target: https://www.google.com/$1  # redirect with params
- regex: ^http://www.google.cn
  match: url
  action: "header"  # rewrite request header Host
  target: http://www.google.com
- regex: ^https?:\/\/(www.)?jd\.com\/
  match: url
  action: "302"
  target: https://www.jd.com/
- regex: ^https?://(www.)?google.cn/search
  match: url
  action: "404"  # response with http status code 404
  target: https://www.google.com/search
- regex: ^https?:\/\/.+\.googlevideo\.com\/.+&oad
  match: url
  action: reject-image  # response with 1x1 pixel emtpy image
  target: ""
- regex: ^http://www.google.cn
  match: url
  action: "reject"  # close connection immediately
  target: ""  
- regex: ^https?:\/\/api\.douban\.com\/v\d\/app_ads\/
  match: url
  action: reject
  target: ""
- regex: ^https?:\/\/api\.douban\.com\/v2\/app_ads\/common_ads
  match: url
  action: reject-img
  target: ""
- regex: ^https?:\/\/api\.douban\.com\/v2\/app_ads\/splash
  match: url
  action: reject-img
  target: ""
