const { wifi, v4 } = $network;
const v4IP = v4.primaryAddress;
if (!v4IP) {
    $done({
        title: "未连接网络",
        content: "请检查网络连接",
        icon: "airplane",
        "icon-color": "#ff9800"
    });
} else {
    $httpClient.get("https://myip.ipip.net/json", function (error, response, data) {
        data = JSON.parse(data);
        ip = data['data']['ip'];
        country = data['data']['location'][0];
        region = data['data']['location'][1];
        city = data['data']['location'][2];
        asn = data['asn'];
        isp = data['data']['location'][4];
        org = data['org'];
        var flags = new Map([
            ["AC", "🇦🇨"],
            ["AF", "🇦🇫"],
            ["AI", "🇦🇮"],
            ["AL", "🇦🇱"],
            ["AM", "🇦🇲"],
            ["AQ", "🇦🇶"],
            ["AR", "🇦🇷"],
            ["AS", "🇦🇸"],
            ["AT", "🇦🇹"],
            ["AU", "🇦🇺"],
            ["AW", "🇦🇼"],
            ["AX", "🇦🇽"],
            ["AZ", "🇦🇿"],
            ["BB", "🇧🇧"],
            ["BD", "🇧🇩"],
            ["BE", "🇧🇪"],
            ["BF", "🇧🇫"],
            ["BG", "🇧🇬"],
            ["BH", "🇧🇭"],
            ["BI", "🇧🇮"],
            ["BJ", "🇧🇯"],
            ["BM", "🇧🇲"],
            ["BN", "🇧🇳"],
            ["BO", "🇧🇴"],
            ["BR", "🇧🇷"],
            ["BS", "🇧🇸"],
            ["BT", "🇧🇹"],
            ["BV", "🇧🇻"],
            ["BW", "🇧🇼"],
            ["BY", "🇧🇾"],
            ["BZ", "🇧🇿"],
            ["CA", "🇨🇦"],
            ["CF", "🇨🇫"],
            ["CH", "🇨🇭"],
            ["CK", "🇨🇰"],
            ["CL", "🇨🇱"],
            ["CM", "🇨🇲"],
            ["中国", "🇨🇳"],
            ["CO", "🇨🇴"],
            ["CP", "🇨🇵"],
            ["CR", "🇨🇷"],
            ["CU", "🇨🇺"],
            ["CV", "🇨🇻"],
            ["CW", "🇨🇼"],
            ["CX", "🇨🇽"],
            ["CY", "🇨🇾"],
            ["CZ", "🇨🇿"],
            ["DE", "🇩🇪"],
            ["DG", "🇩🇬"],
            ["DJ", "🇩🇯"],
            ["DK", "🇩🇰"],
            ["DM", "🇩🇲"],
            ["DO", "🇩🇴"],
            ["DZ", "🇩🇿"],
            ["EA", "🇪🇦"],
            ["EC", "🇪🇨"],
            ["EE", "🇪🇪"],
            ["EG", "🇪🇬"],
            ["EH", "🇪🇭"],
            ["ER", "🇪🇷"],
            ["ES", "🇪🇸"],
            ["ET", "🇪🇹"],
            ["EU", "🇪🇺"],
            ["FI", "🇫🇮"],
            ["FJ", "🇫🇯"],
            ["FK", "🇫🇰"],
            ["FM", "🇫🇲"],
            ["FO", "🇫🇴"],
            ["FR", "🇫🇷"],
            ["GA", "🇬🇦"],
            ["GB", "🇬🇧"],
            ["香港", "🇭🇰"],
            ["HU", "🇭🇺"],
            ["ID", "🇮🇩"],
            ["IE", "🇮🇪"],
            ["IL", "🇮🇱"],
            ["IM", "🇮🇲"],
            ["IN", "🇮🇳"],
            ["IS", "🇮🇸"],
            ["IT", "🇮🇹"],
            ["日本", "🇯🇵"],
            ["韩国", "🇰🇷"],
            ["LU", "🇱🇺"],
            ["MO", "🇲🇴"],
            ["MX", "🇲🇽"],
            ["MY", "🇲🇾"],
            ["NL", "🇳🇱"],
            ["PH", "🇵🇭"],
            ["RO", "🇷🇴"],
            ["RS", "🇷🇸"],
            ["RU", "🇷🇺"],
            ["RW", "🇷🇼"],
            ["SA", "🇸🇦"],
            ["SB", "🇸🇧"],
            ["SC", "🇸🇨"],
            ["SD", "🇸🇩"],
            ["SE", "🇸🇪"],
            ["新加坡", "🇸🇬"],
            ["TH", "🇹🇭"],
            ["TN", "🇹🇳"],
            ["TO", "🇹🇴"],
            ["TR", "🇹🇷"],
            ["TV", "🇹🇻"],
            ["台湾", "🇨🇳"],
            ["UK", "🇬🇧"],
            ["UM", "🇺🇲"],
            ["美国", "🇺🇸"],
            ["UY", "🇺🇾"],
            ["UZ", "🇺🇿"],
            ["VA", "🇻🇦"],
            ["VE", "🇻🇪"],
            ["VG", "🇻🇬"],
            ["VI", "🇻🇮"],
            ["VN", "🇻🇳"],
            ["ZA", "🇿🇦"]
        ])
        flag = flags.get(data['data']['location'][0]);
        if (city != '') {
            data = region + ' ' + city + ' ' + isp + ' ' + ip;
        } else {
            data = region + ' ' + isp + ' ' + ip;
        };
        $done({
            title: "本地 IP 信息",
            //content: 'IP：' + ip + '\n' + '地区：' + country + '\n' + '城市：' +  city + '\n' + 'ASN：' + asn + '\n' + 'ISP：' + isp +'\n' + '组织：' + org,
            content: data,
            style: 'info',
        });
    });
}