{
  "always_run_in_app" : false,
  "icon" : {
    "color" : "blue",
    "glyph" : "feather-alt"
  },
  "name" : "「DJG」国内疫情",
  "script" : "\/*\n\/\/ 抖音搜索：大舅哥科技\n\/\/ 微信搜索小程序「大舅哥科技」\n\/\/ 获取更多精美实用 iOS 桌面组件！\n\/\/ 更多免费精选快捷指令、壁纸，等你！\n\/\/ ***************************\n\/\/ 环境框架   ：@ DmYY\n\/\/ script\t ：@ DJG\n*\/\n\nFILE = FileManager.local()\nFILEPATH = FILE.joinPath(FILE.libraryDirectory(), \"\/DJG.js\")\nconst { DJG, Runing } = importModule(FILEPATH);\n\n\/\/ @组件代码开始\nclass Widget extends DJG {\n  constructor(arg) {\n    super(arg);\n    this.name = '国内疫情';\n    this.widget_ID = \"DJG-101\";\n    this.version = \"V3.5\";\n    this.coviddataUrl = \"https:\/\/api.inews.qq.com\/newsqa\/v1\/query\/inner\/publish\/modules\/list?modules=statisGradeCityDetail,diseaseh5Shelf\";\n    this.covidurl = 'https:\/\/voice.baidu.com\/act\/newpneumonia\/newpneumonia\/?from=osari_aladin_top1#tab0';\n    this.citys = [\n      '江苏','云南','广东','湖南','湖北','上海','四川','天津','河南','山东','福建','陕西','北京','黑龙江','浙江',\n      '河北','安徽','新疆','江西','重庆','吉林','辽宁','内蒙古','广西','山西','甘肃','海南','贵州','宁夏','青海'];\n\tthis.cityCode = [\n      'jiangsu','yn','gd','hn','hb','sh','cd','tj','henan','sd','fj','xian','bj','helongjiang','zj','hebei','ah',\n      'xinjiang','jiangxi','cq','jilin','ln','neimenggu','guangxi','shanxi','gansu','hainan','guizhou','ningxia','qinghai','xizang'];\n    this.Run();\n  }\n  \n  \/**\n   * 渲染函数，函数名固定\n   * 可以根据 this.widgetFamily 来判断小组件尺寸，以返回不同大小的内容\n   *\/\n  async render () {\n    let widget = this.getWidget();\n    await this.getWidgetBackgroundImage(widget);\n    try{\n      switch (this.widgetFamily) {\n        case 'small':\n        \tawait this.renderSmall(widget);\n        \tbreak;\n        case 'medium':\n        \tawait this.renderMedium(widget);\n        \tbreak;\n        default:\n        \tawait this.renderMedium(widget, true);\n        \tbreak;\n      }\n    }catch(e){\n      this.ERROR.push({error:e.toString()});\n    }\n    return widget;\n  }\n  \n  formatr(str) {\n    return (str<0 ? \"较昨日\"+str : \"较昨日+\"+str)\n  }\n  \n  \/\/ 小组件\n  async renderSmall(widget){\n    widget.setPadding(10, 15, 10, 15);\n    let coviddata = await this.httpGet(this.coviddataUrl);\n    coviddata = coviddata.data.diseaseh5Shelf.areaTree[0].children.splice(0, 3);\n    this.addText(widget, `🦠   国内疫情`, 12, {font:'bold', opaciry:0.8});\n    widget.addSpacer();\n    for(let i = 0; i < coviddata.length; i++){\n      let confirm = coviddata[i].today.confirm;\n      if(confirm > 0) confirm = '+' + confirm;\n      const covidArr = [coviddata[i].name, coviddata[i].total.confirm, confirm];\n      this.addText(widget, `${covidArr[0]}  ${covidArr[1]}`, 13);\n      this.addText(widget, `新增：${covidArr[2]}`, 10, {font:'bold', opaciry:0.8, color:'FF8247'});\n      widget.addSpacer(3)\n    }\n    widget.addSpacer(5);\n    this.addText(widget, coviddata[0].total.mtime, 9, {opaciry:0.8, align:'center'})\n  }\n  \n  \/\/ 中组件\n  async renderMedium(w, bool=false){\n    let coviddata = await this.httpGet(this.coviddataUrl)\n    coviddata = coviddata.data.diseaseh5Shelf;\n    let chinaTotal = coviddata.chinaTotal;\n    let chinaAdd = coviddata.chinaAdd;\n    w.addSpacer(5)\n    this.addText(w, '🦠 '+this.name, 12, {font:'bold', opacity:0.8});\n    w.addSpacer(8)\n    \n    let upStack = w.addStack()\n    upStack.layoutHorizontally()\n    upStack.url = this.covidurl;\n    const titles = [\"本土现有确诊\",\"现有确诊\",\"累计确诊\"]\n    const newsdatas = [`${chinaTotal.localConfirmH5}`,`${chinaTotal.nowConfirm}`,`${chinaTotal.confirm}`]\n    const colors = ['FF4500', 'FF00FF', 'FFA500']\n    const newAdd = [chinaAdd.localConfirmH5,chinaAdd.nowConfirm,chinaAdd.confirm]\n    \n    const titles2 = [\"无症状感染者\",\"境外输入\",\"累计死亡\"]\n    const cityNewsdata = [`${chinaTotal.noInfect}`,`${chinaTotal.importedCase}`,`${chinaTotal.dead}`]\n    const cityCor = ['FF0000', '00CD00', '666666'];\n    const cityNewAdd = [chinaAdd.noInfect,chinaAdd.importedCase,chinaAdd.dead]\n    \n    for(let i = 0; i < 3; i++){\n      let stack = upStack.addStack()\n      stack.layoutVertically()\n      \n      this.addText(stack, titles[i], 14)\n      stack.addSpacer(1)\n      this.addText(stack, this.numFormatr(newsdatas[i]), 14, {font:'bold', color:colors[i]})\n      stack.addSpacer(1)\n      this.addText(stack, this.formatr(newAdd[i]), 9, {font:'bold', opacity:0.8})\n      i != 2 ? upStack.addSpacer(): \"\"\n      stack.addSpacer(8)\n      this.addText(stack, titles2[i], 14)\n      stack.addSpacer(1)\n      this.addText(stack, this.numFormatr(cityNewsdata[i]), 14, {font:'bold', color:cityCor[i]})\n      stack.addSpacer(1)\n      this.addText(stack, this.formatr(cityNewAdd[i]), 9, {font:'bold', opacity:0.8})\n      i != 2 ? upStack.addSpacer(): \"\";\n    }\n    if(bool) {\n      w.addSpacer(8)\n      const body = w.addStack()\n      body.layoutVertically()\n      const news = await this.covidNews() || [];\n      if(news.length != 0){\n        this.addText(body, `${this.settings.city||'国内'}疫情最新资讯`, 14, {font:'light'})\n        body.addSpacer(7)\n        for(let i = 0; i < 7; i++){\n          this.addText(body, `${i+1}. ${news[i].title}`, 13, {font:'light', url:news[i].news_url})\n          if(i !=6) body.addSpacer(6)\n        }\n      }\n    }\n    \n    w.addSpacer(5)\n    this.addText(w, coviddata.lastUpdateTime, 9, {opacity:0.8,align:'right'})\n  }\n\n  \/\/ 疫情资讯\n  async covidNews(){\n    if(!this.settings.city){\n      let date = new Date();\n      let covidNewsURL = \"https:\/\/channel.chinanews.com\/cns\/s\/5013.shtml?pager=0&_=\"+Math.floor(date.getTime());\n      let data = (await this.httpGet2(covidNewsURL, false)).slice(17,-29);\n      return JSON.parse(data).docs\n    } else {\n      if(this.citys.indexOf(this.settings.city) != -1){\n      \tlet cityID = this.cityCode[this.citys.indexOf(this.settings.city)];\n      \tif(cityID){\n          let covidNewsURL = `https:\/\/api.dreamreader.qq.com\/news\/v1\/province\/news\/list?province_code=${cityID}&page_size=10`;\n          let covidNews = await this.httpGet(covidNewsURL);\n          return covidNews.data.items\n        }\n      }else {logError(\"Error：疫情资讯地区设置错误！\")};\n    }\n  }\n  \n  async httpGet2 (url, json = true, useCache = true, options = null, method = 'GET') {\n    let cacheKey = this.hash('channel.chinanews.com');\n    let cacheData = null, error = null;\n    if (this.isUpdate(cacheKey.slice(-8), useCache) || !Keychain.contains(cacheKey)){\n      try {\n        let req = new Request(url)\n        req.method = method\n        if(options){\n          Object.keys(options).forEach((key) => {\n            req[key] = options[key];\n          });\n        }\n        cacheData = await (json ? req.loadJSON() : req.loadString());\n      } catch (e) {\n        error = {url:url, error:e.toString()};\n        this.writeError(error);\n      };\n    }\n    if(cacheData && useCache) {\n      this.saveCacheKey(cacheKey);\n      Keychain.set(cacheKey, json ? JSON.stringify(cacheData) : cacheData)\n    }else if (!cacheData && Keychain.contains(cacheKey)) {\n      let cache = Keychain.get(cacheKey)\n      cacheData = json ? JSON.parse(cache) : cache\n    }else {this.ERROR.push(error);}\n    return cacheData;\n  }\n  \n  \/\/ 添加设置信息\n  Run() {\n    if (config.runsInApp) {\n      this.registerAction(\"基础设置\", this.setWidgetConfig);\n    }\n    this.registerAction(\"地区设置\", async () => {\n      await this.setCustomAction(\"地区设置\", \"设置地区疫情最新资讯\\n正确输入省份地区\\n例如：北京、上海、广东\", {\n        city: \"港澳台地区不支持\",\n      },this.city);\n    }, { name: 'location.circle', color: '#66CD00' });\n  }\n}\n\/\/ @组件代码结束\nawait Runing(Widget)",
  "share_sheet_inputs" : [

  ]
}
