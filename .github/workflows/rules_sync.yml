name: 规则同步

on:
  workflow_dispatch:
  schedule:
    - cron: '30 23 * * *'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@master

    - name: Checkout Files
      uses: actions/checkout@v2
      with:
        repository: iEwha/Rules
        ref: iosRules
        path: Rules

    - name: copy Files
      run: cp -r Rules/. Provider

    - name: Checkout AdRules
      uses: actions/checkout@v2
      with:
        repository: xOS/Config
        ref: Her
        path: Rules

    - name: copy Advertising
      run: cp -r Rules/RuleSet/Advertising.list Provider/Ruleset/Advertising.list
      
    - name: commit
      run: | 
       git status -s
       git config --global user.name ${{ secrets.GIT_USER }}
       git config --global user.email ${{ secrets.GIT_EMAIL }}
       git add .
       git commit -m "Updated at $(TZ=UTC-8 date +'%Y-%m-%d %H:%M:%S')" -a
    - name: Push changes
      uses: ad-m/github-push-action@master
      with:
        git_token: ${{ secrets.GIT_TOKEN }}    
 
