/*
脚本功能:WarpPanel for Surge
脚本描述:一款可以验证Warp,显示IP和流量的面板 @Functional_Store_Hub

脚本作者:R·E
脚本发布:https://t.me/Functional_Store_Hub

更新时间:2022.08.28
使用声明:⚠️⚠️⚠️转载需注明 Functional Store Hub 频道⚠️⚠️⚠️
*/

const _0x6b1ad7='Functional_Store_Hub-WarpPanel';!(async()=>{if($script['type']!='generic'){var _0x3f5707=_0x10eb87(JSON['stringify']($request['headers']),$request['url']);if(_0x3f5707!=null){$persistentStore['write'](_0x3f5707,_0x6b1ad7);$notification['post']('WarpPanel信息获取成功!','Warp信息已写入到持久化存储中','');$done();}else{$notification['post']('WarpPanel信息获取失败','Warp信息未写入到持久化存储中','');$done();}}else{var _0x1201dd=_0x222044(await _0x40f287(_0x42b6af(_0x6b1ad7)));var _0x5b102b='{\x22url\x22:\x22https://cloudflare.com/cdn-cgi/trace\x22,\x22headers\x22:{\x22user-agent\x22:\x22Mozilla/5.0\x20(Macintosh;\x20Intel\x20Mac\x20OS\x20X\x2012_3_1)\x20AppleWebKit/537.36\x20(KHTML,\x20like\x20Gecko)\x20Chrome/100.0.4896.60\x20Safari/537.36\x22}}';var _0x3ee62d=_0x138929(await _0x40f287(_0x5b102b));$done({'title':'𝑾𝒂𝒓𝒑\x20𝑷𝒂𝒏𝒆𝒍+','content':_0x3ee62d+'\x0a'+_0x1201dd,'icon':'scribble.variable'});}})()['catch'](_0x1b19bb=>{console['log'](String(_0x1b19bb));throw new Error(_0x1b19bb);})['finally'](()=>$done());function _0x42b6af(_0xaa8439){var _0x10c460=$persistentStore['read'](_0xaa8439);if(!_0x10c460){$notification['post']('WarpPanel信息获取失败','请先打开\x201.1.1.1\x20获取Warp信息!','打开\x201.1.1.1\x20后会自动获取并提示');$done();}_0x10c460=JSON['parse'](_0x10c460);var _0x326f26=new Object();_0x326f26['url']=_0x10c460['url'];_0x326f26['headers']={};_0x326f26['headers']['cookie']=_0x10c460['cookie'];_0x326f26['headers']['user-agent']=_0x10c460['user-agent'];_0x326f26['headers']['authorization']=_0x10c460['authorization'];return JSON['stringify'](_0x326f26);}function _0x40f287(_0x1a20c4){return new Promise(_0x126565=>{$httpClient['get'](JSON['parse'](_0x1a20c4),(_0x3ca785,_0x4984ac,_0x362f46)=>{try{if(_0x3ca785){throw new Error('请求信息错误\x0a错误内容:'+String(_0x3ca785));}else if(_0x362f46){_0x126565(_0x362f46);}}catch(_0x39f159){console['log'](String(_0x39f159));throw new Error('捕捉到请求信息错误\x0a错误内容:'+String(_0x39f159));}finally{_0x126565();}});});}function _0x10eb87(_0x8fddfe,_0x222d4a){var _0x14a564=JSON['parse'](_0x8fddfe);if(!_0x14a564['cookie']&&!_0x14a564['user-agent']&&!_0x14a564['authorization']){$notification['post']('WarpPanel信息获取失败','Warp信息中的某项为空!请试试打开 MITM over HTTP/2 后重新获取信息','');return null;}var _0x236544=new Object();_0x236544['url']=_0x222d4a;_0x236544['cookie']=_0x14a564['cookie'];_0x236544['user-agent']=_0x14a564['user-agent'];_0x236544['authorization']=_0x14a564['authorization'];return JSON['stringify'](_0x236544);}function _0x222044(_0x1ae142){if(!_0x1ae142){$done({'title':'𝑾𝒂𝒓𝒑\x20𝑷𝒂𝒏𝒆𝒍+','content':'WarpInfo为空!','icon':'scribble.variable'});}var _0x40af28=JSON['parse'](_0x1ae142);if(_0x40af28['result']['account']['account_type']=='limited'){return'使用流量:\x20'+parseInt((_0x40af28['result']['account']['premium_data']-_0x40af28['result']['account']['quota'])/0x400/0x400/0x400)+'GB\x0a剩余流量:\x20'+parseInt(_0x40af28['result']['account']['quota']/0x400/0x400/0x400)+'GB\x0a总计流量:\x20'+parseInt(_0x40af28['result']['account']['premium_data']/0x400/0x400/0x400)+'GB';}else if(_0x40af28['result']['account']['account_type']=='team'){return'使用流量:\x20Team\x20无限制\x0a剩余流量:\x20Team\x20无限制\x0a总计流量:\x20Team\x20无限制';}else if(_0x40af28['result']['account']['account_type']=='free'){return'免费账户,请先刷Warp流量!';}else{return'未知类型,请向\x20@R·E\x20反馈!';}}function _0x138929(_0x2f3405){if(!_0x2f3405){$done({'title':'𝑾𝒂𝒓𝒑\x20𝑷𝒂𝒏𝒆𝒍+','content':'WarpApiInfo为空!','icon':'scribble.variable'});}var _0xe38291=_0x2f3405['match'](/[\s\S]*ip\=(.*)[\s\S]*warp\=(\w+)/);var _0x5741db='';if(_0xe38291[0x2]=='off'){_0x5741db='没有';}else if(_0xe38291[0x2]=='on'){_0x5741db='部分';}else if(_0xe38291[0x2]=='plus'){_0x5741db='完全';}else{_0x5741db='未知';}return'IP信息:\x20'+_0xe38291[0x1]+'\x0aWarp+保护隐私:\x20'+_0x5741db;}
